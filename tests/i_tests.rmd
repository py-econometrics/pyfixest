---
title: "Additional Tests"
author: "Alexander Fischer"
date: "2023-03-19"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{python}
import pandas as pd
import numpy as np
from pyfixest import Fixest

# Read in data
df = pd.read_csv("https://raw.githubusercontent.com/LOST-STATS/LOST-STATS.github.io/master/Model_Estimation/Data/Event_Study_DiD/bacon_example.csv")

df['time_to_treat'] = (df['year'] - df['_nfd'] ).fillna(0).astype(int).astype('category')

df['treat'] = np.where(pd.isna(df['_nfd']), 0, 1)

fixest = Fixest(df)
fml = 'asmrs ~ i(time_to_treat, treat, ref = -1) + pcinc + asmrh + cases | stfips + year'
fixest.feols(fml, vcov = {'CRV1':'stfips'})

coef = fixest.tidy()['Estimate']

fixest.summary()
```

```{r}
library(fixest)
library(reticulate)

coef_py = py$coef
rownames(coef_py) <- NULL
df = py$df

df$time_to_treat <- ifelse(df$treat == 1, as.integer(df$year) - df$`_nfd`, 0)


mod_twfe = feols(asmrs ~ i(time_to_treat, treat, ref = -1) + 
		  pcinc + asmrh + cases |           
		  stfips + year,        
		 cluster = ~stfips, 
		 data = dat)

summary(mod_twfe)

coef_r <- coef(mod_twfe)

all.equal(
  sort(coef(mod_twfe)),
  sort(coef_py),
  check.attributes = FALSE
)

```

