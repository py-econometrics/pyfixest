Code Run:
ssc install b1x2
clear
set obs 1000

gen double x1 = invnorm(uniform())

gen double x21 = x1*1 + invnorm(uniform())

gen double x22 = x1*0.25 + x21*0.75 + invnorm(uniform())

gen double x23 = x1*0.4 + x21*0.6 + x22*0.4 + invnorm(uniform())

gen double y = x1*1 + x21*2 + x22*0.5 + x23*0.75 + invnorm(uniform())

b1x2 y, x1all(x1 x21) x2all(x22 x23) x1only(x1)
b1x2 y, x1all(x1 x21 x22) x2all(x23) x1only(x1)
b1x2 y, x1all(x1 x21) x2all(x22 x23) x2delta(g1 = x22 x23) x1only(x1)



Output:
. ssc install b1x2
checking b1x2 consistency and verifying not already installed...
all files already exist and are up to date.

. clear

. set obs 1000
Number of observations (_N) was 0, now 1,000.

. 
. gen double x1 = invnorm(uniform())

. 
. gen double x21 = x1*1 + invnorm(uniform())

. 
. gen double x22 = x1*0.25 + x21*0.75 + invnorm(uniform())

. 
. gen double x23 = x1*0.4 + x21*0.6 + x22*0.4 + invnorm(uniform())

. 
. gen double y = x1*1 + x21*2 + x22*0.5 + x23*0.75 + invnorm(uniform())

. 
. b1x2 y, x1all(x1 x21) x2all(x22 x23) x1only(x1)

                                                      Number of obs = 1000


Restricted regression:

. b1x2: reg y x1 x21      

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
          x1 |   1.501856   .0677081    22.18   0.000     1.369151    1.634562
         x21 |   2.988225   .0461416    64.76   0.000      2.89779    3.078661
       _cons |  -.0017948   .0472796    -0.04   0.970    -.0944611    .0908714
------------------------------------------------------------------------------

Unrestricted regression:

. b1x2: reg y x1 x21  x22 x23      
------------------------------------------------------------------------------
           y | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
          x1 |   .9574697   .0495461    19.32   0.000     .8603612    1.054578
         x21 |   2.043751   .0431536    47.36   0.000     1.959171     2.12833
         x22 |   .4065763   .0365763    11.12   0.000     .3348881    .4782646
         x23 |   .7912365   .0323223    24.48   0.000      .727886    .8545871
       _cons |  -.0035263   .0326123    -0.11   0.914    -.0674452    .0603925
------------------------------------------------------------------------------

Decomposition of changes in coefficients on x1 vars:

       x1 x21

into parts due to these groups:

ALL  = x22 x23

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
x1           |
         ALL |   .5443866   .0518287    10.50   0.000     .4428043     .645969
        __TC |   .5443866   .0518287    10.50   0.000     .4428043     .645969
------------------------------------------------------------------------------

Note: The __TC...  line is the sum of all x2 variables' impacts on each x1.
      The reported covariance between this coef and all others is zero.
      This is NOT correct!!

Done with -b1x2-.


. b1x2 y, x1all(x1 x21 x22) x2all(x23) x1only(x1)

                                                      Number of obs = 1000


Restricted regression:

. b1x2: reg y x1 x21 x22      

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
          x1 |    1.28869   .0603015    21.37   0.000     1.170501    1.406879
         x21 |   2.455129   .0502868    48.82   0.000     2.356569    2.553689
         x22 |    .754562   .0426373    17.70   0.000     .6709945    .8381296
       _cons |  -.0061345   .0412598    -0.15   0.882    -.0870022    .0747332
------------------------------------------------------------------------------

Unrestricted regression:

. b1x2: reg y x1 x21 x22  x23      
------------------------------------------------------------------------------
           y | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
          x1 |   .9574697   .0495461    19.32   0.000     .8603612    1.054578
         x21 |   2.043751   .0431536    47.36   0.000     1.959171     2.12833
         x22 |   .4065763   .0365763    11.12   0.000     .3348881    .4782646
         x23 |   .7912365   .0323223    24.48   0.000      .727886    .8545871
       _cons |  -.0035263   .0326123    -0.11   0.914    -.0674452    .0603925
------------------------------------------------------------------------------

Decomposition of changes in coefficients on x1 vars:

       x1 x21 x22

into parts due to these groups:

ALL  = x23

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
x1           |
         ALL |   .3312204    .039386     8.41   0.000     .2540253    .4084155
        __TC |   .3312204    .039386     8.41   0.000     .2540253    .4084155
------------------------------------------------------------------------------

Note: The __TC...  line is the sum of all x2 variables' impacts on each x1.
      The reported covariance between this coef and all others is zero.
      This is NOT correct!!

Done with -b1x2-.


. b1x2 y, x1all(x1 x21) x2all(x22 x23) x2delta(g1 = x22 x23) x1only(x1)

                                                      Number of obs = 1000


Restricted regression:

. b1x2: reg y x1 x21      

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
          x1 |   1.501856   .0677081    22.18   0.000     1.369151    1.634562
         x21 |   2.988225   .0461416    64.76   0.000      2.89779    3.078661
       _cons |  -.0017948   .0472796    -0.04   0.970    -.0944611    .0908714
------------------------------------------------------------------------------

Unrestricted regression:

. b1x2: reg y x1 x21  x22 x23      
------------------------------------------------------------------------------
           y | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
          x1 |   .9574697   .0495461    19.32   0.000     .8603612    1.054578
         x21 |   2.043751   .0431536    47.36   0.000     1.959171     2.12833
         x22 |   .4065763   .0365763    11.12   0.000     .3348881    .4782646
         x23 |   .7912365   .0323223    24.48   0.000      .727886    .8545871
       _cons |  -.0035263   .0326123    -0.11   0.914    -.0674452    .0603925
------------------------------------------------------------------------------

Decomposition of changes in coefficients on x1 vars:

       x1 x21

into parts due to these groups:

g1  = x22 x23

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
x1           |
          g1 |   .5443866   .0518287    10.50   0.000     .4428043     .645969
        __TC |   .5443866   .0518287    10.50   0.000     .4428043     .645969
------------------------------------------------------------------------------

Note: The __TC...  line is the sum of all x2 variables' impacts on each x1.
      The reported covariance between this coef and all others is zero.
      This is NOT correct!!

Done with -b1x2-.
