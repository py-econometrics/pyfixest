{
  "hash": "a4daab9fb1f6fcf96f99e0e8594b89ae",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: The Mixtape with PyFixest\naliases:\n  - /mixtape.html\njupyter: python3\n---\n\n\nIn this notebook, we translate some of the Python code in [Scott Cunningham's mixtape](https://mixtape.scunning.com/) to PyFixest.\n\n::: {#5da75188 .cell execution_count=1}\n``` {.python .cell-code}\nimport numpy as np\nimport pandas as pd\n\nimport pyfixest as pf\n\n%config InlineBackend.figure_format = \"retina\"\n```\n:::\n\n\n## Chapter 8: Panel Data\n\nInstead of demeaning by hand and then fitting the model via statsmodels, we just let PyFixest do all the work for us. \n\n::: {#a3f297e7 .cell execution_count=2}\n``` {.python .cell-code}\n# read the data from github & load into pandas\nurl = \"https://raw.githubusercontent.com/scunning1975/mixtape/master/sasp_panel.dta\"\nsasp = pd.read_stata(url)\nsasp.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=2}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>id</th>\n      <th>session</th>\n      <th>age</th>\n      <th>age_cl</th>\n      <th>appearance_cl</th>\n      <th>bmi</th>\n      <th>schooling</th>\n      <th>asq_cl</th>\n      <th>provider_second</th>\n      <th>asian_cl</th>\n      <th>...</th>\n      <th>hispanic</th>\n      <th>other</th>\n      <th>white</th>\n      <th>asq</th>\n      <th>cohab</th>\n      <th>married</th>\n      <th>divorced</th>\n      <th>separated</th>\n      <th>nevermarried</th>\n      <th>widowed</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>243.0</td>\n      <td>2.0</td>\n      <td>27.0</td>\n      <td>30.0</td>\n      <td>5.0</td>\n      <td>NaN</td>\n      <td>11.0</td>\n      <td>900.0</td>\n      <td>1. No</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>729.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>397.0</td>\n      <td>4.0</td>\n      <td>28.0</td>\n      <td>56.0</td>\n      <td>5.0</td>\n      <td>28.971931</td>\n      <td>16.0</td>\n      <td>3136.0</td>\n      <td>1. No</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>784.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>598.0</td>\n      <td>4.0</td>\n      <td>50.0</td>\n      <td>52.0</td>\n      <td>6.0</td>\n      <td>21.453857</td>\n      <td>16.0</td>\n      <td>2704.0</td>\n      <td>1. No</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>2500.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>28.0</td>\n      <td>1.0</td>\n      <td>41.0</td>\n      <td>72.0</td>\n      <td>5.0</td>\n      <td>24.028320</td>\n      <td>12.0</td>\n      <td>5184.0</td>\n      <td>1. No</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>1681.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>28.0</td>\n      <td>4.0</td>\n      <td>41.0</td>\n      <td>46.0</td>\n      <td>8.0</td>\n      <td>24.028320</td>\n      <td>12.0</td>\n      <td>2116.0</td>\n      <td>1. No</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>1681.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n  </tbody>\n</table>\n<p>5 rows × 31 columns</p>\n</div>\n```\n:::\n:::\n\n\n::: {#e614e216 .cell execution_count=3}\n``` {.python .cell-code}\n# some initial data cleaning\nsasp = sasp.dropna()\n# order by id and session\nsasp.sort_values(\"id\", inplace=True)\n\n# create balanced panel\ntimes = len(sasp.session.unique())\nin_all_times = (\n    sasp.groupby(\"id\")[\"session\"].apply(lambda x: len(x) == times).reset_index()\n)\nin_all_times.rename(columns={\"session\": \"in_all_times\"}, inplace=True)\nbalanced_sasp = pd.merge(in_all_times, sasp, how=\"left\", on=\"id\")\nbalanced_sasp = balanced_sasp[balanced_sasp.in_all_times]\n\nprovider_second = np.zeros(balanced_sasp.shape[0])\nprovider_second[balanced_sasp.provider_second == \"2. Yes\"] = 1\nbalanced_sasp.provider_second = provider_second\n```\n:::\n\n\n::: {#beff82f9 .cell execution_count=4}\n``` {.python .cell-code}\n# define formulas\n\ncovars = \"\"\"\n    age + asq + bmi + hispanic + black + other + asian + schooling + cohab +\n            married + divorced + separated + age_cl + unsafe + llength + reg + asq_cl +\n            appearance_cl + provider_second + asian_cl + black_cl + hispanic_cl +\n           othrace_cl + hot + massage_cl\n    \"\"\"\n\n# we fit on all covariates\nfml_pooled = f\"lnw ~ {covars}\"\n# we fit on all covariates and add one-hot encoded id fixed effects\nfml_onehot = f\"lnw ~  {covars} + C(id)\"\n# we fit on all covariates and swipe out the fixed effects (i.e. we apply the within transformation via pyfixest.feols)\nfml_fe = f\"lnw ~ {covars} | id\"\n```\n:::\n\n\n::: {#4bc51f0e .cell execution_count=5}\n``` {.python .cell-code}\n%%capture\nfit_pooled = pf.feols(fml=fml_pooled, data=balanced_sasp, vcov={\"CRV1\": \"id\"})\nfit_fe = pf.feols(fml=fml_fe, data=balanced_sasp, vcov={\"CRV1\": \"id\"})\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nOMP: Info #276: omp_set_nested routine deprecated, please use omp_set_max_active_levels instead.\n```\n:::\n:::\n\n\n::: {#52c17e23 .cell execution_count=6}\n``` {.python .cell-code}\npf.etable(\n    [fit_pooled, fit_fe],\n    model_heads=[\"POLS\", \"FE\"],\n    keep=[\"unsafe\", \"llength\", \"reg\"],\n    labels={\n        \"unsafe\": \"Unprotected sex with client of any kind\",\n        \"llength\": \"Ln(Length)\",\n        \"reg\": \"Client was a Regular\",\n    },\n    digits=6,\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<div id=\"hfvjrfeojg\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>\n#hfvjrfeojg table {\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n          -webkit-font-smoothing: antialiased;\n          -moz-osx-font-smoothing: grayscale;\n        }\n\n#hfvjrfeojg thead, tbody, tfoot, tr, td, th { border-style: none; }\n tr { background-color: transparent; }\n#hfvjrfeojg p { margin: 0; padding: 0; }\n #hfvjrfeojg .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: hidden; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }\n #hfvjrfeojg .gt_caption { padding-top: 4px; padding-bottom: 4px; }\n #hfvjrfeojg .gt_title { color: #333333; font-size: 16px; font-weight: initial; padding-top: 6px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }\n #hfvjrfeojg .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 5px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }\n #hfvjrfeojg .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #hfvjrfeojg .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; }\n #hfvjrfeojg .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: black; border-bottom-style: solid; border-bottom-width: 0.25px; border-bottom-color: black; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }\n #hfvjrfeojg .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 16px; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 0px; border-left-color: white; border-right-style: none; border-right-width: 0px; border-right-color: white; vertical-align: bottom; padding-top: 2px; padding-bottom: 7px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }\n #hfvjrfeojg .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 16px; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }\n #hfvjrfeojg .gt_column_spanner_outer:first-child { padding-left: 0; }\n #hfvjrfeojg .gt_column_spanner_outer:last-child { padding-right: 0; }\n #hfvjrfeojg .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 0.25px; border-bottom-color: black; vertical-align: bottom; padding-top: 2px; padding-bottom: 2px; overflow-x: hidden; display: inline-block; width: 100%; }\n #hfvjrfeojg .gt_spanner_row { border-bottom-style: hidden; }\n #hfvjrfeojg .gt_group_heading { padding-top: 0px; padding-bottom: 0px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 0px; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 0.25px; border-top-color: black; border-bottom-style: solid; border-bottom-width: 0.25px; border-bottom-color: black; border-left-style: none; border-left-width: 1px; border-left-color: white; border-right-style: none; border-right-width: 1px; border-right-color: white; vertical-align: middle; text-align: left; }\n #hfvjrfeojg .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 0px; font-weight: initial; border-top-style: solid; border-top-width: 0.25px; border-top-color: black; border-bottom-style: solid; border-bottom-width: 0.25px; border-bottom-color: black; vertical-align: middle; }\n #hfvjrfeojg .gt_from_md> :first-child { margin-top: 0; }\n #hfvjrfeojg .gt_from_md> :last-child { margin-bottom: 0; }\n #hfvjrfeojg .gt_row { padding-top: 2px; padding-bottom: 2px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: none; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 0px; border-left-color: white; border-right-style: none; border-right-width: 0px; border-right-color: white; vertical-align: middle; overflow-x: hidden; }\n #hfvjrfeojg .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 16px; font-weight: initial; text-transform: inherit; border-right-style: hidden; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; }\n #hfvjrfeojg .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }\n #hfvjrfeojg .gt_row_group_first td { border-top-width: 0.25px; }\n #hfvjrfeojg .gt_row_group_first th { border-top-width: 0.25px; }\n #hfvjrfeojg .gt_striped { color: #333333; background-color: #F4F4F4; }\n #hfvjrfeojg .gt_table_body { border-top-style: solid; border-top-width: 0px; border-top-color: black; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: black; }\n #hfvjrfeojg .gt_grand_summary_row { color: #333333; background-color: #FFFFFF; text-transform: inherit; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; }\n #hfvjrfeojg .gt_first_grand_summary_row_bottom { border-top-style: double; border-top-width: 6px; border-top-color: #D3D3D3; }\n #hfvjrfeojg .gt_last_grand_summary_row_top { border-bottom-style: double; border-bottom-width: 6px; border-bottom-color: #D3D3D3; }\n #hfvjrfeojg .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }\n #hfvjrfeojg .gt_sourcenote { font-size: 10px; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }\n #hfvjrfeojg .gt_left { text-align: left; }\n #hfvjrfeojg .gt_center { text-align: center; }\n #hfvjrfeojg .gt_right { text-align: right; font-variant-numeric: tabular-nums; }\n #hfvjrfeojg .gt_font_normal { font-weight: normal; }\n #hfvjrfeojg .gt_font_bold { font-weight: bold; }\n #hfvjrfeojg .gt_font_italic { font-style: italic; }\n #hfvjrfeojg .gt_super { font-size: 65%; }\n #hfvjrfeojg .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }\n #hfvjrfeojg .gt_asterisk { font-size: 100%; vertical-align: 0; }\n \n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n<thead>\n\n<tr class=\"gt_col_headings gt_spanner_row\">\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\">\n    <span>&nbsp</span>\n  </th>\n  <th class=\"gt_center gt_columns_bottom_border gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"2\" scope=\"colgroup\">\n    <span class=\"gt_column_spanner\">lnw</span>\n  </th>\n</tr>\n<tr class=\"gt_col_headings gt_spanner_row\">\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"2\" colspan=\"1\" scope=\"col\" id=\"\"></th>\n  <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"POLS\">\n    <span class=\"gt_column_spanner\">POLS</span>\n  </th>\n  <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"FE\">\n    <span class=\"gt_column_spanner\">FE</span>\n  </th>\n</tr>\n<tr class=\"gt_col_headings\">\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"0\">(1)</th>\n  <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"1\">(2)</th>\n</tr>\n</thead>\n<tbody class=\"gt_table_body\">\n  <tr class=\"gt_group_heading_row\">\n    <th class=\"gt_group_heading\" colspan=\"3\">coef</th>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">Unprotected sex with client of any kind</th>\n    <td class=\"gt_row gt_center\">0.013407 <br> (0.042455)</td>\n    <td class=\"gt_row gt_center\">0.051034 <br> (0.028283)</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">Ln(Length)</th>\n    <td class=\"gt_row gt_center\">-0.308251*** <br> (0.040905)</td>\n    <td class=\"gt_row gt_center\">-0.434506*** <br> (0.024323)</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">Client was a Regular</th>\n    <td class=\"gt_row gt_center\">-0.047007 <br> (0.033282)</td>\n    <td class=\"gt_row gt_center\">-0.037341* <br> (0.018761)</td>\n  </tr>\n  <tr class=\"gt_group_heading_row\">\n    <th class=\"gt_group_heading\" colspan=\"3\">fe</th>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">id</th>\n    <td class=\"gt_row gt_center\">-</td>\n    <td class=\"gt_row gt_center\">x</td>\n  </tr>\n  <tr class=\"gt_group_heading_row\">\n    <th class=\"gt_group_heading\" colspan=\"3\">stats</th>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">Observations</th>\n    <td class=\"gt_row gt_center\">1,028</td>\n    <td class=\"gt_row gt_center\">1,028</td>\n  </tr>\n  <tr>\n    <th class=\"gt_row gt_left gt_stub\">R<sup>2</sup></th>\n    <td class=\"gt_row gt_center\">0.303</td>\n    <td class=\"gt_row gt_center\">0.832</td>\n  </tr>\n</tbody>\n  <tfoot class=\"gt_sourcenotes\">\n  \n  <tr>\n    <td class=\"gt_sourcenote\" colspan=\"3\">Significance levels: * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001. Format of coefficient cell: Coefficient   (Std. Error)</td>\n  </tr>\n\n</tfoot>\n\n</table>\n\n</div>\n        \n```\n:::\n:::\n\n\nOur point estimates match the Stata results that Scott reports in the mixtape exactly. The standard errors differ slightly due to differences in small sample adjustments in Stata and Pyfixest. See [here](https://py-econometrics.github.io/pyfixest/ssc.html) for an overview of how pyfixest handles small sample adjustments (tldr - exactly like r-fixest). \n\n## Chapter 9: Difference-in-Differences\n\n### Code Example 1\n\n::: {#f51c2c44 .cell execution_count=7}\n``` {.python .cell-code}\nabortion = pd.read_stata(\n    \"https://raw.githubusercontent.com/scunning1975/mixtape/master/abortion.dta\"\n)\nabortion = abortion[~pd.isnull(abortion.lnr)]\nabortion_bf15 = abortion[abortion.bf15 == 1]\n# pf throws error when weights are 0\nabortion_bf15 = abortion_bf15[abortion_bf15.totpop > 0]\nabortion_bf15[\"year\"] = abortion_bf15[\"year\"].astype(int)\nabortion_bf15.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=7}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>fip</th>\n      <th>age</th>\n      <th>race</th>\n      <th>year</th>\n      <th>sex</th>\n      <th>totcase</th>\n      <th>totpop</th>\n      <th>rate</th>\n      <th>totrate</th>\n      <th>id</th>\n      <th>...</th>\n      <th>female</th>\n      <th>lnr</th>\n      <th>t</th>\n      <th>younger</th>\n      <th>fa</th>\n      <th>pi</th>\n      <th>wm15</th>\n      <th>wf15</th>\n      <th>bm15</th>\n      <th>bf15</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>19</th>\n      <td>1.0</td>\n      <td>15.0</td>\n      <td>2.0</td>\n      <td>1985</td>\n      <td>2</td>\n      <td>5683.0</td>\n      <td>106187</td>\n      <td>6527.500000</td>\n      <td>5351.899902</td>\n      <td>14.0</td>\n      <td>...</td>\n      <td>1.0</td>\n      <td>8.783779</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n    </tr>\n    <tr>\n      <th>39</th>\n      <td>1.0</td>\n      <td>15.0</td>\n      <td>2.0</td>\n      <td>1986</td>\n      <td>2</td>\n      <td>5344.0</td>\n      <td>106831</td>\n      <td>6351.200195</td>\n      <td>5002.299805</td>\n      <td>14.0</td>\n      <td>...</td>\n      <td>1.0</td>\n      <td>8.756399</td>\n      <td>2.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n    </tr>\n    <tr>\n      <th>71</th>\n      <td>1.0</td>\n      <td>15.0</td>\n      <td>2.0</td>\n      <td>1987</td>\n      <td>2</td>\n      <td>4983.0</td>\n      <td>106496</td>\n      <td>5759.100098</td>\n      <td>4679.000000</td>\n      <td>14.0</td>\n      <td>...</td>\n      <td>1.0</td>\n      <td>8.658537</td>\n      <td>3.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n    </tr>\n    <tr>\n      <th>89</th>\n      <td>1.0</td>\n      <td>15.0</td>\n      <td>2.0</td>\n      <td>1988</td>\n      <td>2</td>\n      <td>5276.0</td>\n      <td>105238</td>\n      <td>6139.600098</td>\n      <td>5013.399902</td>\n      <td>14.0</td>\n      <td>...</td>\n      <td>1.0</td>\n      <td>8.722515</td>\n      <td>4.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n    </tr>\n    <tr>\n      <th>106</th>\n      <td>1.0</td>\n      <td>15.0</td>\n      <td>2.0</td>\n      <td>1989</td>\n      <td>2</td>\n      <td>5692.0</td>\n      <td>102956</td>\n      <td>5951.500000</td>\n      <td>5528.600098</td>\n      <td>14.0</td>\n      <td>...</td>\n      <td>1.0</td>\n      <td>8.691399</td>\n      <td>5.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n    </tr>\n  </tbody>\n</table>\n<p>5 rows × 39 columns</p>\n</div>\n```\n:::\n:::\n\n\n::: {#31aa6357 .cell execution_count=8}\n``` {.python .cell-code}\n# we use the i() operator pyfixest provides, as it allows us to easily set the\n# reference year, and works smoothly with the iplot() method\n\nfml = \"\"\"lnr ~ i(year, repeal, ref = 1985) + C(repeal) + C(year) + C(fip)\n        + acc + ir + pi + alcohol + crack + poverty + income + ur\n\"\"\"\n\nfit = pf.feols(fml=fml, data=abortion_bf15, weights=\"totpop\", vcov={\"CRV1\": \"fip\"})\n\npf.iplot(\n    fit,\n    coord_flip=False,\n    plot_backend=\"matplotlib\",\n    title=\"Event Study Estimate\",\n    cat_template=\"{value}\",\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n/Users/afischer/Documents/pyfixest/pyfixest/estimation/models/feols_.py:2465: UserWarning: \n            1 variables dropped due to multicollinearity.\n            The following variables are dropped: ['C(fip)[T.53.0]'].\n            \n  warnings.warn(\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=8}\n![](mixtape_files/figure-html/cell-9-output-2.png){width=945 height=564}\n:::\n:::\n\n\n",
    "supporting": [
      "mixtape_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js\" integrity=\"sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js\" integrity=\"sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}